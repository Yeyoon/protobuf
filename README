
Protobuf is a Common Lisp implementation of Google's protocol buffers.

This directory contains a preliminary release of the support functions
needed to serialize protocol buffers.  Not all features are currently
implemented.  The code works well enough that simple serialization tests
pass.

The code has been tested with ABCL, CCL, CLISP, and SBCL.  In the past it
has also worked with Allegro Common Lisp, but I have not tested it recently.

This git repository requires another git repository called google-protobuf,
which contains Google's protocol buffer compiler, modified to generate
Common Lisp code.  The google-protobuf repository is pulled in using git's
submodule feature.


INSTALLATION
============

1. Clone the protobuf git repository and google-protobuf git repository that
it pulls in as a submodule dependency:

    git clone git://github.com/brown/protobuf.git
    cd protobuf
    git submodule init
    git submodule update


2. Install the software needed to compile Google's C++ protocol buffer
compiler.  You'll need at least G+++ and libtool, which on a Linux system can
often be installed with:

    apt-get install g++ libtool


3. Compile Google's C++ protocol buffer compiler, which can translate
protocol buffer definition files into Common Lisp code.  On my system I
install the protocol buffer compiler in directory
/local/software/package/google-protobuf.  You are free to install it
elsewhere.

    cd google-protobuf
    ./autogen.sh
    ./configure --prefix=/local/software/package/google-protobuf
    make
    make install


4. Download and install the Common Lisp packages that protobuf depends on:

    ASDF
    trivial-utf-8       (not needed for Allegro, CLisp, and SBCL)

Note that some Common Lisp implementations, such as SBCL, already contain a
copy of the ASDF library.


5. Make protobuf.asd available to ASDF.  Either create a symbolic link to
protobuf.asd in your ASDF:*CENTRAL-REGISTRY* directory or load the file into
your running Lisp with (load "protobuf.asd").


6. Specify the location of the protocol buffer compiler.  The path to use
depends on the installation location you chose when you ran "configure" in
the google-protobuf directory.

    (defvar asdf::*protobuf-compiler*
            #p"/local/software/package/google-protobuf/bin/protoc")


7. Run the tests:

    (asdf:operate 'asdf:test-op 'protobuf-test)

8. Compile and run the example code:

    (asdf:operate 'asdf:load-up 'protobuf-example)

    (in-package address-book)
    (add-person :id 100
                :name "Robert Brown"
                :email-address "brown@foo.com"
                :phone-numbers '((home . "718-555-1212")
                                 (work . "212-589-1212")
                                 (mobile . "917-555-1212")))
    (list-prople)


BUGS
====

Please report bugs and send suggestions to protobuf-devel@common-lisp.net or
contact me directly.  My email is robert.brown at the mail hosting site
gmail.com.
